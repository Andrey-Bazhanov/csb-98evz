{"version":3,"sources":["assets/grass.jpg","Ground.js","assets/axe.glb","Axe.js","Player.js","assets/dirt.jpg","Cube.js","App.js","index.js"],"names":["Ground","props","usePlane","rotation","Math","PI","ref","texture","useLoader","THREE","grass","wrapS","wrapT","receiveShadow","args","map","color","Model","group","useRef","useGLTF","axeUrl","nodes","materials","dispose","scale","geometry","Mesh_1001_1","material","material_2","Mesh_1001_2","material_3","preload","keys","KeyW","KeyS","KeyA","KeyD","Space","moveFieldByKey","key","direction","frontVector","sideVector","speed","Player","axe","useSphere","mass","type","position","api","useState","forward","backward","left","right","jump","movement","setMovement","useEffect","handleKeyDown","e","m","code","handleKeyUp","document","addEventListener","removeEventListener","usePlayerControls","camera","useThree","velocity","subscribe","v","current","useFrame","state","getWorldPosition","set","Number","subVectors","normalize","multiplyScalar","applyEuler","fromArray","children","x","lerp","sin","length","clock","elapsedTime","copy","add","getWorldDirection","z","abs","toFixed","onPointerMissed","ydoc","Y","WebrtcProvider","ymap","getMap","cubeStore","proxy","cubes","addCube","y","push","bindProxyAndYMap","Cubes","snapshot","slice","setSlice","useCubes","coords","index","Cube","useBox","hover","dirt","onMove","useCallback","stopPropagation","floor","faceIndex","onOut","onClick","dir","castShadow","onPointerMove","onPointerOut","Array","_","attachArray","App","shadows","gl","alpha","fov","raycaster","computeOffsets","offsetX","target","width","offsetY","height","Sky","sunPosition","intensity","gravity","PointerLockControls","Overlay","ready","className","date","year","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.e26d831f.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/grass.eb5fc8eb.jpg\";","import * as THREE from \"three\"\nimport { useLoader } from \"@react-three/fiber\"\nimport { usePlane } from \"@react-three/cannon\"\nimport grass from \"./assets/grass.jpg\"\n\nexport const Ground = (props) => {\n  const [ref] = usePlane(() => ({ rotation: [-Math.PI / 2, 0, 0], ...props }))\n  const texture = useLoader(THREE.TextureLoader, grass)\n  texture.wrapS = texture.wrapT = THREE.RepeatWrapping\n  return (\n    <mesh ref={ref} receiveShadow>\n      <planeGeometry args={[1000, 1000]} />\n      <meshStandardMaterial map={texture} map-repeat={[240, 240]} color=\"green\" />\n    </mesh>\n  )\n}\n","export default __webpack_public_path__ + \"static/media/axe.9fbbc709.glb\";","/*\nAuto-generated by: https://github.com/pmndrs/gltfjsx\nauthor: Blender3D (https://sketchfab.com/Blender3D)\nlicense: CC-BY-4.0 (http://creativecommons.org/licenses/by/4.0/)\nsource: https://sketchfab.com/models/0d62f4d3676545c88ec8523213c055dd\ntitle: Minecraft Diamond Axe\n*/\n\nimport React, { useRef } from \"react\"\nimport { useGLTF } from \"@react-three/drei\"\nimport axeUrl from \"./assets/axe.glb\"\n\nexport default function Model(props) {\n  const group = useRef()\n  const { nodes, materials } = useGLTF(axeUrl)\n  return (\n    <group ref={group} dispose={null} {...props}>\n      <group rotation={[0, Math.PI / 1.8, -0.3]} scale={0.5}>\n        <mesh geometry={nodes.Mesh_1001_1.geometry} material={materials.material_2} />\n        <mesh geometry={nodes.Mesh_1001_2.geometry} material={materials.material_3} />\n      </group>\n    </group>\n  )\n}\n\nuseGLTF.preload(\"/axe.glb\")\n","import * as THREE from \"three\"\nimport { useEffect, useRef, useState } from \"react\"\nimport { useSphere } from \"@react-three/cannon\"\nimport { useThree, useFrame } from \"@react-three/fiber\"\nimport Axe from \"./Axe\"\n\nconst SPEED = 5\nconst keys = { KeyW: \"forward\", KeyS: \"backward\", KeyA: \"left\", KeyD: \"right\", Space: \"jump\" }\nconst moveFieldByKey = (key) => keys[key]\nconst direction = new THREE.Vector3()\nconst frontVector = new THREE.Vector3()\nconst sideVector = new THREE.Vector3()\nconst rotation = new THREE.Vector3()\nconst speed = new THREE.Vector3()\n\nconst usePlayerControls = () => {\n  const [movement, setMovement] = useState({ forward: false, backward: false, left: false, right: false, jump: false })\n  useEffect(() => {\n    const handleKeyDown = (e) => setMovement((m) => ({ ...m, [moveFieldByKey(e.code)]: true }))\n    const handleKeyUp = (e) => setMovement((m) => ({ ...m, [moveFieldByKey(e.code)]: false }))\n    document.addEventListener(\"keydown\", handleKeyDown)\n    document.addEventListener(\"keyup\", handleKeyUp)\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown)\n      document.removeEventListener(\"keyup\", handleKeyUp)\n    }\n  }, [])\n  return movement\n}\n\nexport const Player = (props) => {\n  const axe = useRef()\n  const [ref, api] = useSphere(() => ({ mass: 1, type: \"Dynamic\", position: [0, 10, 0], ...props }))\n  const { forward, backward, left, right, jump } = usePlayerControls()\n  const { camera } = useThree()\n  const velocity = useRef([0, 0, 0])\n  useEffect(() => api.velocity.subscribe((v) => (velocity.current = v)), [])\n  useFrame((state) => {\n    ref.current.getWorldPosition(camera.position)\n    frontVector.set(0, 0, Number(backward) - Number(forward))\n    sideVector.set(Number(left) - Number(right), 0, 0)\n    direction.subVectors(frontVector, sideVector).normalize().multiplyScalar(SPEED).applyEuler(camera.rotation)\n    speed.fromArray(velocity.current)\n    axe.current.children[0].rotation.x = THREE.MathUtils.lerp(\n      axe.current.children[0].rotation.x,\n      Math.sin((speed.length() > 1) * state.clock.elapsedTime * 10) / 6,\n      0.1,\n    )\n    axe.current.rotation.copy(camera.rotation)\n    axe.current.position.copy(camera.position).add(camera.getWorldDirection(rotation).multiplyScalar(1))\n    api.velocity.set(direction.x, velocity.current[1], direction.z)\n    if (jump && Math.abs(velocity.current[1].toFixed(2)) < 0.05) api.velocity.set(velocity.current[0], 10, velocity.current[2])\n  })\n  return (\n    <>\n      <mesh ref={ref} />\n      <group ref={axe} onPointerMissed={(e) => (axe.current.children[0].rotation.x = -0.5)}>\n        <Axe position={[0.3, -0.35, 0.5]} />\n      </group>\n    </>\n  )\n}\n","export default __webpack_public_path__ + \"static/media/dirt.59ed3279.jpg\";","import * as THREE from \"three\"\nimport { useCallback, useEffect, useState } from \"react\"\nimport { useLoader } from \"@react-three/fiber\"\nimport { useBox } from \"@react-three/cannon\"\nimport { proxy, subscribe, snapshot } from \"valtio\"\nimport * as Y from \"yjs\"\nimport { bindProxyAndYMap } from \"valtio-yjs\"\nimport { WebrtcProvider } from \"y-webrtc\"\nimport dirt from \"./assets/dirt.jpg\"\n\nconst ydoc = new Y.Doc()\nnew WebrtcProvider(\"minecraft-valtio-yjs-demo-2\", ydoc)\nconst ymap = ydoc.getMap(\"map\")\n\n// This is a super naive implementation and wouldn't allow for more than a few thousand boxes.\n// In order to make this scale this has to be one instanced mesh, then it could easily be\n// hundreds of thousands.\n\nconst cubeStore = proxy({\n  cubes: [],\n})\nconst addCube = (x, y, z) => {\n  cubeStore.cubes.push([x, y, z])\n}\nconst useCubes = () => {\n  const [slice, setSlice] = useState(() => snapshot(cubeStore).cubes)\n  useEffect(() => {\n    return subscribe(cubeStore, () => {\n      setSlice(snapshot(cubeStore).cubes)\n    })\n  }, [])\n  return slice || []\n}\n\nbindProxyAndYMap(cubeStore, ymap)\n\nexport const Cubes = () => {\n  const cubes = useCubes()\n  return cubes.map((coords, index) => <Cube key={index} position={coords} />)\n}\n\nexport const Cube = (props) => {\n  const [ref] = useBox(() => ({ type: \"Static\", ...props }))\n  const [hover, set] = useState(null)\n  const texture = useLoader(THREE.TextureLoader, dirt)\n  const onMove = useCallback((e) => (e.stopPropagation(), set(Math.floor(e.faceIndex / 2))), [])\n  const onOut = useCallback(() => set(null), [])\n  const onClick = useCallback((e) => {\n    e.stopPropagation()\n    const { x, y, z } = ref.current.position\n    const dir = [\n      [x + 1, y, z],\n      [x - 1, y, z],\n      [x, y + 1, z],\n      [x, y - 1, z],\n      [x, y, z + 1],\n      [x, y, z - 1],\n    ]\n    addCube(...dir[Math.floor(e.faceIndex / 2)])\n  }, [])\n  return (\n    <mesh ref={ref} receiveShadow castShadow onPointerMove={onMove} onPointerOut={onOut} onClick={onClick}>\n      {[...Array(6)].map((_, index) => (\n        <meshStandardMaterial attachArray=\"material\" key={index} map={texture} color={hover === index ? \"hotpink\" : \"white\"} />\n      ))}\n      <boxGeometry />\n    </mesh>\n  )\n}\n","import { Canvas } from \"@react-three/fiber\"\nimport { Sky, PointerLockControls } from \"@react-three/drei\"\nimport { Physics } from \"@react-three/cannon\"\nimport { Ground } from \"./Ground\"\nimport { Player } from \"./Player\"\nimport { Cube, Cubes } from \"./Cube\"\n\n// The original was made by Maksim Ivanow: https://www.youtube.com/watch?v=Lc2JvBXMesY&t=124s\n// This demo needs pointer-lock, that works only if you open it in a new window\n// Controls: WASD + left click\n\nexport default function App() {\n  return (\n    <Canvas\n      shadows\n      gl={{ alpha: false }}\n      camera={{ fov: 45 }}\n      raycaster={{\n        computeOffsets: (e) => ({ offsetX: e.target.width / 2, offsetY: e.target.height / 2 }),\n      }}>\n      <Sky sunPosition={[100, 20, 100]} />\n      <ambientLight intensity={0.3} />\n      <pointLight castShadow intensity={0.8} position={[100, 100, 100]} />\n      <Physics gravity={[0, -30, 0]}>\n        <Ground />\n        <Player />\n        <Cube position={[0, 0.5, -10]} />\n        <Cubes />\n      </Physics>\n      <PointerLockControls />\n    </Canvas>\n  )\n}\n","import { useState } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { Footer } from \"@pmndrs/branding\"\nimport \"./styles.css\"\nimport App from \"./App\"\n\nfunction Overlay() {\n  const [ready, set] = useState(false)\n  return (\n    <>\n      <App />\n      <div className=\"dot\" />\n      <div className={`fullscreen bg ${ready ? \"ready\" : \"notready\"} ${ready && \"clicked\"}`}>\n        <div className=\"stack\">\n          <button onClick={() => set(true)}>Click (needs fullscreen)</button>\n        </div>\n        <Footer date=\"16. June\" year=\"2021\" />\n      </div>\n    </>\n  )\n}\n\nReactDOM.render(<Overlay />, document.getElementById(\"root\"))\n"],"sourceRoot":""}